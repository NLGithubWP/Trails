import matplotlib.pyplot as plt
from matplotlib.ticker import FuncFormatter

# Sample data, replace this with your actual data
memory_log = {
    "with all opt": [[0.050140442, 18872], [0.162401403, 38040], [0.274808354, 69264], [0.384969505, 90436],
                     [0.496301064, 139620], [0.611033351, 149300], [0.724517419, 161212], [0.84159792, 167176],
                     [0.959336644, 172456], [1.075227888, 186188], [1.1924553, 200972], [1.308997421, 216284],
                     [1.425876989, 231596], [1.542312678, 237364], [1.6538338160000001, 237364],
                     [1.7704422050000002, 237364], [1.886532139, 237364], [2.002174324, 237364], [2.118925544, 237364],
                     [2.235420063, 287312], [2.3548039210000002, 302556], [2.467121581, 416300], [2.578182876, 439096],
                     [2.686566172, 438772], [2.7941013789999998, 440604], [2.906132113, 440184], [3.023285342, 441936],
                     [3.135325571, 442224], [3.245023464, 443404], [3.354455546, 442940], [3.464556558, 442492],
                     [3.574903441, 441596], [3.682942486, 440568], [3.7942856000000003, 440504], [3.901109951, 439360],
                     [4.011331285, 438912], [4.11849316, 440068], [4.228043233, 451536], [4.335476977, 450932],
                     [4.446344116, 451804], [4.55336098, 453540], [4.663194285, 455392], [4.770195428, 455016],
                     [4.880081225, 449076], [4.987075522, 450912], [5.097966694, 452300], [5.20453793, 451540],
                     [5.312908156, 452948], [5.420247292, 452052], [5.528487856, 451604], [5.636604251, 451156],
                     [5.748680914, 452880], [5.858671093, 453144], [5.966319229, 452248], [6.073323568, 452760],
                     [6.181752031, 453336], [6.292698444, 453592], [6.403879722, 453144], [6.510719176, 452252],
                     [6.61704133, 452956], [6.724829514, 452508], [6.834465099, 455964], [6.944170493, 456604],
                     [7.053910553, 456156], [7.161698358, 455648], [7.268737687, 455840], [7.377555495, 455392],
                     [7.489367331, 456156], [7.600017368, 455740], [7.710595002, 455292], [7.81759085, 454416],
                     [7.925776069, 454204], [8.032343577, 453760], [8.142774571, 455848], [8.25351653, 455152],
                     [8.362645298, 465748], [8.473494108, 466004], [8.583371172, 466104], [8.693718414, 466484],
                     [8.800828892, 466032], [8.908079508, 466616], [9.016430535, 467012], [9.127949017, 467836],
                     [9.238323449, 468212], [9.346139533, 467640], [9.453306842, 466784], [9.582641379, 467492],
                     [9.692633804, 469172], [9.802341191, 468592], [9.909853082, 467340], [10.01654275, 466892],
                     [10.123155202, 466828], [10.234553863, 468360], [10.34440348, 469840], [10.451477071, 468944],
                     [10.558416773, 468496], [10.667062442, 468048], [10.779078642, 469712],
                     [10.889490844000001, 469840], [10.996739527, 468948], [11.104075186, 468500],
                     [11.212276324, 468116]],
    # "w/o state cache": [],
    # "w/o memory sharing": [
    #     [0.0144259, 20804], [1.030951876, 184876], [2.909390436, 314468], [4.738563242, 315680],
    #     [6.553871011, 317364], [8.392857958, 319112], [9.408757094, 320844], [11.25468476, 323972],
    #     [13.08372853, 326176], [14.921665195, 327536], [16.741873756, 329992], [18.577636054, 331960],
    #     [20.396168183, 334424]
    # ],
    # "w/o all opt": [
    #     [0.0144259, 20804], [1.030951876, 184876], [2.909390436, 314468], [4.738563242, 315680],
    #     [6.553871011, 317364], [8.392857958, 319112], [9.408757094, 320844], [11.25468476, 323972],
    #     [13.08372853, 326176], [14.921665195, 327536], [16.741873756, 329992], [18.577636054, 331960],
    #     [20.396168183, 334424]
    # ],
}


# Helper function for formatting the y-axis
def mb_formatter(x, pos):
    return '{:.1f} MB'.format(x)


# Set up the plot
fig, ax = plt.subplots(figsize=(10, 6))

# Define colors for different lines
colors = ['blue', 'green', 'red', 'purple']
# Define line styles for different lines
line_styles = ['-', '--', '-.', ':']

# Plot each configuration
for (label, data), color, line_style in zip(memory_log.items(), colors, line_styles):
    # Convert memory usage to MB
    timestamps = [x[0] for x in data]
    memory_usage = [x[1] / 1024 for x in data]  # Convert KB to MB

    ax.plot(timestamps, memory_usage, label=label, color=color, linestyle=line_style, marker='o', linewidth=2)

# Formatting the y-axis
ax.yaxis.set_major_formatter(FuncFormatter(mb_formatter))

# Adding labels and title
ax.set_xlabel('Time (s)', fontsize=14)
ax.set_ylabel('Memory Usage (MB)', fontsize=14)
ax.set_title('Memory Usage Over Time', fontsize=16)
ax.grid(True, linestyle='--', linewidth=0.5)

# Show legend
ax.legend()

# Display the plot
plt.tight_layout()
plt.show()
